# Chemin du nouveau répertoire d'outputs
output_dir <- file.path(base_path, "outputs")

# Créer le répertoire 'outputs' s'il n'existe pas
if (!dir.exists(output_dir)) {
  dir.create(output_dir, recursive = TRUE)
  cat("Dossier de sortie créé à l'emplacement :", output_dir, "\n")
} else {
  cat("Le dossier de sortie existe déjà :", output_dir, "\n")
}

# Importation du shapefile des aires protégées
SE_shp <- file.path(base_path, "/data/data2/202303-osm2igeo-cameroun-shp-wgs84-4326/202303_OSM2IGEO_CAMEROUN_SHP_WGS84_4326/D_OSM_HYDROGRAPHIE/SURFACE_EAU.shp")

# Importation du shapefile du Cameroun
CMR_shp_0 <- file.path(base_path, "/data/data2/shapefiles_limites_administratives_GADM_Cameroun/gadm41_CMR_0.shp")
CMR_shp_1 <- file.path(base_path, "/data/data2/shapefiles_limites_administratives_GADM_Cameroun/gadm41_CMR_1.shp")

# Lecture du shapefile des aires protégées
SE <- st_read(SE_shp)

print(table(SE$NATURE))

SE_fleuves_rivieres <- SE %>%
  filter(NATURE == "Fleuve, rivière")


# Lecture du shapefile du cameroun
cameroun_limite_0 <- st_read(CMR_shp_0)
cameroun_limite_1 <- st_read(CMR_shp_1)




# Visualisation statique des fleuves et rivières sur la carte du Cameroun
ggplot() +
  
  # Couche de font (Cameroun)
  geom_sf(data = cameroun_limite_1,
          fill = "grey95",
          color = "grey30",
          size = 0.5) +
  
  # Couche principale
  geom_sf(data = SE_fleuves_rivieres,
          aes(fill = "Fleuve ou rivière"),
          color = "blue",
          size = 0.5) +
  
  # Configuration des couleurs et de la légende
  scale_fill_manual(values = "blue", name = "Légende :") +
  
  # Ajout de titres et informations
  labs(title = "Visualisation des fleuves et rivières au Cameroun",
       caption = paste(
         "Nombre de fleuves et rivières :", nrow(SE_fleuves_rivieres),
         "\n\nSource : GADM (Carte du Cameroun) & OpenStreetMap (fleuves et rivières)"
       )
  ) +
  
  # Thème pour une meilleure présentation
  theme_minimal() +
  
  # Ajustement de la taille, de la légende et de la caption
  theme(
    
    aspect.ratio = 1.2,
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    
    # Déplacement la légende à gauche
    legend.position = "right",
    
    # Centrage du texte de la caption (nombre d'aires et sources) en bas
    plot.caption = element_text(hjust = 0.3, size = 10, color = "grey30"),
    
    # Ajustement la marge du titre pour libérer l'espace en haut
    plot.title = element_text(hjust = 0.1, face = "bold"),
  )


# Chemin complet pour l'enregistrement
output_file_path <- file.path(output_dir, "carte_statique_fleuve_riviere.png")

# Enregistrer le graphique
ggsave(filename = output_file_path,
       width = 8, 
       height = 10, 
       units = "in",
       dpi = 300)




# Visualisation dynamique 
carte_tmap <- 
  # Couche de fond (Cameroun)
  tm_shape(cameroun_limite_1) +
  #  tm_fill(col = "grey90", legend.show = FALSE) + 
  tm_borders(col = "grey50", lwd = 1) +
  
  # Couche principale 
  tm_shape(SE_fleuves_rivieres) +
  tm_fill(col = "blue", alpha = 0.6, legend.show = FALSE) + # Remplissage sans légende ici
  tm_borders(col = "blue", lwd = 0.5) +
  
  # Ajout d'une légende
  tm_add_legend(
    type = "fill", 
    col = "blue",
    labels = "Fleuve ou rivière", 
    title = "Légende :"
  ) +
  
  # Mise en page 
  tm_layout(
    title = "Fleuves et rivières du Cameroun",
    title.position = c("center", "top"),
    title.size = 1.2,
    
    # Positionnement de la légende
    legend.position = c("right", "top"),
    legend.title.size = 0.6,
    legend.text.size = 0.4,
    
    frame = FALSE, # Retrait de l'encadrement
    inner.margins = c(0.01, 0.01, 0.01, 0.01)
  ) +
  
  # Ajout des informations en bas de page
  tm_credits(text = paste("Nombre de fleuves et rivières :", nrow(SE_fleuves_rivieres)),
             position = c("left", "bottom"),
             size = 0.7,
             col = "grey30") +
  tm_credits(text = "Source : OpenStreetMap & GADM",
             position = c("right", "bottom"), 
             size = 0.6,
             col = "grey30",
             align = "right")


tmap_mode("view") 
#print(carte_tmap)
