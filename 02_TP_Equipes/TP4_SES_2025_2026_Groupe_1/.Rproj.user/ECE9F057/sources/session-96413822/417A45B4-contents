# ==============================================================================
# FICHIER PRINCIPAL DU PROJET R
# ==============================================================================

# --- 1. Installation et Chargement des Librairies ---
packages <- c("sf", "ggplot2", "tmap", "rnaturalearth", "rnaturalearthdata", 
              "dplyr", "tidyr", "shiny", "leaflet", "webshot", "mapview", "units", "nngeo",
              "osmdata", "osmextract", "ggspatial", "here", "plotly", "htmlwidgets",
              "viridis", "RColorBrewer", "leaflet.extras", "httr", "jsonlite", "data.table", "terra")

install_and_load <- function(pkg){
  if (!requireNamespace(pkg, quietly = TRUE)) {
    install.packages(pkg, dependencies = TRUE)
  }
  library(pkg, character.only = TRUE)
}

cat("Chargement des librairies...\n")
sapply(packages, install_and_load)

# --- 2. D√©finition des Chemins ---
base_path <- "C:/Users/DELL/Desktop/TP2_SES_2025_2026_ASTOU_MAREME_LANDRY_YAMAHA/TP2_SES_2025_2026_ASTOU_MAREME_LANDRY_YAMAHA"
output_dir <- file.path(base_path, "outputs")
scripts_dir <- file.path(base_path, "scripts")
data_dir <- file.path(base_path, "data")

if (!dir.exists(output_dir)) dir.create(output_dir, recursive = TRUE)

# --- 3. Ex√©cution des Scripts ---
cat("\nD√©but de l'ex√©cution s√©quentielle des scripts...\n")

scripts <- c(
  "Visualisation_Aires prot√©g√©es.R",
  "Visualisation_Cours d'eau.R", 
  "Visualisation_Fleuves et rivi√®res.R",
  "Visualisation_Grandes villes.R",
  "Visualisation_H√¥pitaux.R",
  "script1.R",
  "script2.R"
)

for(script in scripts) {
  cat("  -> Ex√©cution du script :", script, "...\n")
  source(file.path(scripts_dir, script), encoding = "UTF-8", echo = FALSE) 
  cat("  -> Fin de l'ex√©cution de :", script, "\n")
}

# --- 4. Tableau de Bord Interactif ---
cat("\n EX√âCUTION DU TABLEAU DE BORD INTERACTIF...\n")
cat(" IMPORTANT : Lorsque la bo√Æte de dialogue s'ouvre, s√©lectionnez le dossier 'data' contenant vos fichiers OSM (.shp)\n")
cat("   Ce dossier doit contenir les fichiers : gis_osm_places_free_1.shp, gis_osm_pois_free_1.shp, etc.\n")
cat("   Appuyez sur OK pour continuer...\n")

# Pause pour laisser lire le message
readline(prompt = "Appuyez sur Entr√©e pour continuer...")

cat("  -> Ex√©cution du script : tableau de bord.R ...\n")
source(file.path(scripts_dir, "tableau de bord.R"), encoding = "UTF-8", echo = FALSE) 
cat("  -> Fin de l'ex√©cution de : tableau de bord.R\n")

# --- 5. V√©rification finale ---
cat("\n" , strrep("=", 60), "\n")
cat("‚úÖ TOUS LES SCRIPTS ONT √âT√â EX√âCUT√âS\n")
cat(strrep("=", 60), "\n")

# V√©rifier les fichiers g√©n√©r√©s
fichiers_sortie <- list.files(output_dir, pattern = "\\.html$|\\.csv$|\\.png$", full.names = FALSE)
if (length(fichiers_sortie) > 0) {
  cat("üìÅ FICHIERS G√âN√âR√âS DANS", output_dir, ":\n")
  for(fichier in fichiers_sortie) {
    taille <- file.size(file.path(output_dir, fichier))
    cat("   ‚Ä¢", fichier, "(", round(taille/1024, 1), "KB )\n")
  }
} else {
  cat("‚ùå Aucun fichier de sortie trouv√©\n")
}

cat("\nüéâ PROJET TERMIN√â AVEC SUCC√àS!\n")
cat("üìç Acc√©dez √† vos r√©sultats dans le dossier:", output_dir, "\n")